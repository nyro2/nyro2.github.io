---
layout: default
title: 日記
---
### Gambit SchemeでGLFW3
　結論から言うとWIP。  
　GLADにGLFW3の関数ポインタをなんやかんやするあたりでうまくいってないっぽい？  

```
(c-declare "#include \"glad/glad.h\"")
(c-declare "#include \"GLFW/glfw3.h\"")

(c-define-type GLFWmonitor* (pointer "GLFWmonitor" GLFWmonitor*))
(c-define-type GLFWwindow* (pointer "GLFWwindow" GLFWwindow*))
(c-define-type GLFWglproc (function () void))

(define GLFW_CONTEXT_VERSION_MAJOR #x00022002)
(define GLFW_CONTEXT_VERSION_MINOR #x00022003)
(define GLFW_OPENGL_PROFILE #x00022008)
(define GLFW_OPENGL_CORE_PROFILE #x00032001)

(define glfwInit (c-lambda () int "glfwInit"))
(define glfwWindowHint (c-lambda (int int) void "glfwWindowHint"))
(define glfwCreateWindow 
  (c-lambda (int int nonnull-char-string GLFWmonitor* GLFWwindow*) GLFWwindow* 
            "glfwCreateWindow"))
(define glfwMakeContextCurrent (c-lambda ((pointer "GLFWwindow")) void "glfwMakeContextCurrent"))
(define glfwGetProcAddress (c-lambda (char-string) GLFWglproc "glfwGetProcAddress")) 
(define gladLoadGLLoader (c-lambda ("GLADloadproc") int "gladLoadGLLoader"))
(define glViewport (c-lambda (int int int int) void "glViewport"))

(glfwInit)
(glfwWindowHint GLFW_CONTEXT_VERSION_MAJOR 3)
(glfwWindowHint GLFW_CONTEXT_VERSION_MINOR 3)
(glfwWindowHint GLFW_OPENGL_PROFILE GLFW_OPENGL_CORE_PROFILE)

(define (game-loop)
  (game-loop))

(define (main-loop) 
  (let* ((window (glfwCreateWindow 100 100 "test" #f #f)))
    (glfwMakeContextCurrent window)
    ;(gladLoadGLLoader (glfwGetProcAddress))
    (display (glfwGetProcAddress))
    (game-loop)
    (glViewport 0 0 100 100)
    (game-loop))) 

(main-loop)
```

　(glfwMakeContextCurrent window)までは正常っぽく、ここで無限ループさせる分にはきちんとウィンドウが出る。  
　glfwGetProcAddressの戻り値をgladLoadGLLoaderに渡す時に元のC++ソースではキャストしてるっぽいのだが、そこらへんGambitに移植する際にどうしたものやら……。  
　まだ基礎的な理解が足りてない感はかなりつよい。  
